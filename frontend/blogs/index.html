<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blogs</title>
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/swiper-bundle.min.css" />
    <link rel="stylesheet" href="/css/blogs.css">

</head>

<script>
    function calculateReadTime(text) {
        const wordsPerMinute = 200;
        const numberOfWords = text.split(/\s/g).length;
        const readTime = Math.ceil(numberOfWords / wordsPerMinute);
        return readTime;
    }

    async function recentAndoldPost() {
        const feedsReq = await fetch("https://api.rss2json.com/v1/api.json?rss_url=https://medium.com/feed/@therobinhood");
        const feeds = await feedsReq.json();
        const lenFeeds = feeds.items.length;
        const codingReq = await fetch("https://api.rss2json.com/v1/api.json?rss_url=https://medium.com/feed/tag/coding");
        const coding = await codingReq.json();
        const hackingReq = await fetch("https://api.rss2json.com/v1/api.json?rss_url=https://medium.com/feed/tag/hacking");
        const hacking = await hackingReq.json();
        feeds.items = feeds.items.concat(hacking.items);
        feeds.items = feeds.items.concat(coding.items);

        const recentPosts = [];
        const olderPosts = [];
        const relatedPosts = [];

        for (let i = 0; i < feeds.items.length; i++) {
            const article = {
                title: feeds.items[i].title,
                thumbnail: feeds.items[i].thumbnail,
                pubDate: new Date(feeds.items[i].pubDate.split(' ')[0]).toLocaleDateString(),
                readTime: calculateReadTime(feeds.items[i].content),
                categories: feeds.items[i].categories,
                link: feeds.items[i].link,
                guid: feeds.items[i].guid.split("/p/")[1],
                description: feeds.items[i].description,
                content: feeds.items[i].content
            };
            if (i < 3) {
                recentPosts.push(article);
            }
            else if (i > 3 && i < lenFeeds) {
                console.log("GE", lenFeeds)
                olderPosts.push(article);
            }
            else {
                if (article.thumbnail && article.thumbnail !== "") {
                    relatedPosts.push(article);
                }
            }
        }
        return { recentPosts, olderPosts, relatedPosts };
    }

    function convertToImgTag(anchorTag) {
        if (anchorTag.href.startsWith("https://medium.com/media")) {
            var imgTag = document.createElement("img");
            imgTag.setAttribute("src", anchorTag.href);
            anchorTag.parentNode.insertBefore(imgTag, anchorTag.nextSibling);
            anchorTag.parentNode.removeChild(anchorTag);
        }
    }

    document.addEventListener('DOMContentLoaded', async function () {
        const urlParams = new URLSearchParams(window.location.search);
        const blogId = urlParams.get('id');
        if (!blogId) {
            const { recentPosts, olderPosts, relatedPosts } = await recentAndoldPost();
            console.log(relatedPosts)
            document.querySelector('.blog-post.section-header-offset').remove();
            setupRecentPosts(recentPosts);
            setupOlderPosts(olderPosts);
            setupRelatedPosts(relatedPosts);
        }
        else {
            document.querySelector('.featured-articles.section.section-header-offset').remove();
            document.querySelector('.older-posts.section').remove();
            const { recentPosts, olderPosts, relatedPosts } = await recentAndoldPost();
            const blog = recentPosts.find(post => post.guid === blogId) || olderPosts.find(post => post.guid === blogId) || relatedPosts.find(post => post.guid === blogId);
            const blogPost = document.querySelector('.blog-post.section-header-offset');
            blogPost.innerHTML += `            
            <div class="blog-post-container container">
                <div class="blog-post-data">
                    <h3 class="title blog-post-title">${blog.title}</h3>
                    <div class="article-data">
                        <span>${blog.pubDate}</span>
                        <span class="article-data-spacer"></span>
                        <span>${blog.readTime} Min read</span>
                    </div>
                </div>

                <div class="container">
                    ${blog.content}
                    <div class="author d-grid">
                        <div class="author-image-box">
                            <img src="/assets/author.webp" alt="" class="" >
                        </div>
                        <div class="author-about">
                            <h3 class="author-name">Ansari</h3>
                            <p> Hey everyone,<br/> I'm Ansari, a 22-year-old self-taught programmer and
          your friendly neighborhood South Indian üï∑.
          If you love exploring new techs, productivity mindsets &amp;
          programming or prefer to see someone trying to hack their
          neighbour's wifi, then definitely check out my YouTube channel.</p>
                            <ul class="list social-media">
                                <li class="list-item">
                                    <a href="https://youtube.com/@AmSorry" target="_blank" class="list-link"><i class="ri-youtube-line"></i></a>
                                </li>
                                <li class="list-item">
                                    <a href="https://twitter.com/am5orry" target="_blank"  class="list-link"><i class="ri-twitter-line"></i></a>
                                </li>
                                <li class="list-item">
                                    <a href="https://instagram.com/amsorry_offl" target="_blank"  class="list-link"><i class="ri-instagram-line"></i></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>`
            var anchorTags = document.querySelectorAll("a");
            anchorTags.forEach(function (anchorTag) {
                convertToImgTag(anchorTag);
            });
        }
    });

    function setupRecentPosts(posts) {
        const recentPosts = document.querySelector('.featured-content');
        recentPosts.innerHTML += `<h2 class="title section-title" data-name="Recent Post">Recent Post</h2>`
        posts.forEach((post, index) => {
            const newPost = `
            <a href="/blogs/?id=${post.guid}" class="article featured-article featured-article-${index + 1}">
            <img src="${post.thumbnail}" alt="" class="article-image">
                <span class="article-category">${post.categories[0]}</span>
                <div class="article-data-container">
                    <div class="article-data">
                        <span>${post.pubDate}</span>
                        <span class="article-data-spacer"></span>
                        <span>${post.readTime} Min read</span>
                    </div>
                    <h3 class="title article-title">${post.title}</h3>
                </div>
        </a>`
            recentPosts.innerHTML += newPost;
        });
    }

    function setupOlderPosts(posts) {
        const olderPosts = document.querySelector('.older-posts.section');
        olderPosts.innerHTML += `<div class="container">
            <h2 class="title section-title" data-name="Older posts">Older posts</h2>
            <div class="older-posts-grid-wrapper d-grid">
            </div>
        </div>
`
        posts.forEach((post, index) => {
            const newPost = `
                           <a href="/blogs/?id=${post.guid}" class="article d-grid">
                    <div class="older-posts-article-image-wrapper">
                        <img src="${post.thumbnail}" alt="" class="article-image">
                    </div>

                    <div class="article-data-container">

                        <div class="article-data">
                            <span>${post.pubDate}</span>
                            <span class="article-data-spacer"></span>
                            <span>${post.readTime} Min read</span>
                        </div>
                        <h3 class="title article-title">${post.title}</h3>
                        <p class="article-description">Lorem, ipsum dolor sit amet consectetur adipisicing elit.
                            Similique a tempore sapiente corporis, eaque fuga placeat odit voluptatibus.</p>
                    </div>
                </a>`
            const olderPosts = document.querySelector('.older-posts-grid-wrapper');
            olderPosts.innerHTML += newPost;
        });
    }

    function setupRelatedPosts(posts) {
        console.log(posts)
        const relatedPosts = document.querySelector('.older-posts.section.related-posts');
        relatedPosts.innerHTML += `<div class="container">
            <h2 class="title section-title" data-name="Related posts">Related posts</h2>
            <div class="older-posts-grid-wrapper relatedposts d-grid">
            </div>
        </div>
`
        posts.forEach((post, index) => {
            const newPost = `
                           <a href="/blogs/?id=${post.guid}" class="article d-grid">
                    <div class="older-posts-article-image-wrapper">
                        <img src="${post.thumbnail}" alt="" class="article-image">
                    </div>

                    <div class="article-data-container">

                        <div class="article-data">
                            <span>${post.pubDate}</span>
                            <span class="article-data-spacer"></span>
                            <span>${post.readTime} Min read</span>
                        </div>
                        <h3 class="title article-title">${post.title}</h3>
                        <p class="article-description">Lorem, ipsum dolor sit amet consectetur adipisicing elit.
                            Similique a tempore sapiente corporis, eaque fuga placeat odit voluptatibus.</p>
                    </div>
                </a>`
            const olderPosts = document.querySelector('.older-posts-grid-wrapper.relatedposts');
            olderPosts.innerHTML += newPost;
        });
    }


    async function substackSubscribtion(e) {
        e.preventDefault();
        const btn = document.getElementById("submitID");
        const msg = document.getElementById("newsletter-error");
        const email = e.target.email.value;
        const data = {
            domain: "amsorry.substack.com",
            email: email
        }

        btn.disabled = true;

        const results = await fetch("https://us-central1-substackapi.cloudfunctions.net/subscribe", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
        });

        const jsonss = await results.json();

        if (jsonss.errors) {
            msg.style.display = "block";
            msg.style.color = "#cf7763";
            msg.innerHTML = jsonss.errors[0].msg;
        }
        else {
            msg.style.display = "block";
            msg.style.color = "lightgreen";
            msg.innerHTML = "We've sent you a confirmation email. Please check your inbox."
        }

        setTimeout(() => {
            btn.disabled = false;
            msg.style.display = "none";
        }, 5000);
    }
</script>

<body>
    <!-- Header -->
    <header class="header" id="header">

        <nav class="navbar container">
            <a href="./index.html">
                <h2 class="logo" style="font-family: 'Wordle'">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç Wordle</h2>
            </a>

            <div class="menu" id="menu">
                <ul class="list">
                    <li class="list-item">
                        <a href="/" class="list-link">Home</a>
                    </li>
                    <li class="list-item">
                        <a href="/blogs/" class="list-link current">Blogs</a>
                    </li>
                    <li class="list-item">
                        <a href="/about/" class="list-link">About Me</a>
                    </li>
                </ul>
            </div>

            <div class="list list-right">
                <button class="btn place-items-center" id="theme-toggle-btn"
                    style="display:flex;justify-content:end;width: 100px;">
                    <i class="ri-sun-line sun-icon"></i>
                    <i class="ri-moon-line moon-icon"></i>
                </button>
                <button class="btn place-items-center screen-lg-hidden menu-toggle-icon" id="menu-toggle-icon">
                    <i class="ri-menu-3-line open-menu-icon"></i>
                    <i class="ri-close-line close-menu-icon"></i>
                </button>
            </div>

        </nav>

    </header>

    <!-- Recent articles -->
    <section class="featured-articles section section-header-offset">
        <div class="container d-grid">
            <div class="featured-content d-grid">
            </div>
        </div>
    </section>

    <!-- Older posts -->
    <section class="older-posts section">
    </section>

    <section class="blog-post section-header-offset">
    </section>

    <!-- Newsletter -->
    <section class="newsletter section">

        <div class="container">
            <div class="form-container-inner">
                <h6 class="title newsletter-title">Subscribe to Friday Fuel</h6>
                <p class="newsletter-description">
                    Why not subscribe to newsletter and get the latest updates and articles straight to your inbox?
                    <b> Go ahead and Subscribe !!</b>
                </p>

                <form class="form" onsubmit="substackSubscribtion(event)">
                    <p id="newsletter-error"></p>
                    <div style="display:flex;align-items: center;">
                        <input class="form-input" type="email" name="email" placeholder="Enter your email address">
                        <button style="height: 59px;" class="btn form-btn" type="submit" id="submitID">
                            <i class="ri-mail-send-line"></i>
                        </button>
                    </div>
                </form>

            </div>

        </div>

    </section>

    <section class="older-posts section related-posts">
    </section>

    <!-- Footer -->
    <footer class="footer section">

        <div class="footer-container container d-grid">

            <div class="company-data">
                <a href="/">
                    <h2 class="logo">Friday Fuel</h2>
                </a>
                <p class="company-description">Friday Fuel is a weekly newsletter that provides valuable insights and
                    actionable advice on productivity and tech.The
                    goal is to help you level up your productivity and stay ahead of the tech curve.</p>

                <ul class="list social-media">
                    <li class="list-item">
                        <a href="https://instagram.com/amsorry_offl" class="list-link"><i
                                class="ri-instagram-line"></i></a>
                    </li>
                    <li class="list-item">
                        <a href="https://youtube.com/@AmSorry" class="list-link"><i class="ri-youtube-line"></i></a>
                    </li>
                    <li class="list-item">
                        <a href="https://twitter.com/am5orry" class="list-link"><i class="ri-twitter-line"></i></a>
                    </li>
                    <li class="list-item">
                        <a href="https://github.com/The-Robin-Hood" class="list-link"><i class="ri-github-line"></i></a>
                    </li>
                </ul>

                <span class="copyright-notice">&copy;2023 Friday Fuel. All rights reserved.</span>
            </div>

            <div>
                <h6 class="title footer-title">Useful links</h6>

                <ul class="footer-list list">
                    <li class="list-item">
                        <a href="/" class="list-link">Home</a>
                    </li>
                    <li class="list-item">
                        <a href="/Blogs" class="list-link">Blogs</a>
                    </li>
                    <li class="list-item">
                        <a href="/About" class="list-link">About Me</a>
                    </li>
                </ul>

            </div>
        </div>

    </footer>

    <!-- Swiper.js -->
    <script src="/js/swiper-bundle.min.js"></script>
    <!-- Custom script -->
    <script src="/js/blogs.js"></script>
</body>

</html>